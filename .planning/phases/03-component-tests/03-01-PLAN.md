---
phase: 03-component-tests
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - __tests__/components/GachaGame.test.tsx
  - __tests__/components/Quiz.test.tsx
autonomous: true

must_haves:
  truths:
    - "GachaGame 컴포넌트가 배너 선택 시 올바르게 반응한다"
    - "GachaGame 컴포넌트가 뽑기 버튼 클릭 시 결과를 표시한다"
    - "Quiz 컴포넌트가 문제를 표시하고 답변을 처리한다"
    - "Quiz 컴포넌트가 결과 화면에서 점수를 표시한다"
  artifacts:
    - path: "__tests__/components/GachaGame.test.tsx"
      provides: "GachaGame 렌더링 및 상호작용 테스트"
      min_lines: 80
    - path: "__tests__/components/Quiz.test.tsx"
      provides: "Quiz 플로우 테스트"
      min_lines: 100
  key_links:
    - from: "__tests__/components/GachaGame.test.tsx"
      to: "components/gacha_simulator/GachaGame.tsx"
      via: "render and fireEvent"
      pattern: "render.*GachaGame"
    - from: "__tests__/components/Quiz.test.tsx"
      to: "components/quiz/Quiz.tsx"
      via: "render and user events"
      pattern: "render.*Quiz"
---

<objective>
GachaGame과 Quiz 핵심 컴포넌트의 렌더링 및 상호작용 테스트를 작성한다.

Purpose: 사용자 입장에서 가장 중요한 두 기능(가챠 시뮬레이션, 퀴즈)이 올바르게 동작함을 검증하여 회귀 방지
Output: GachaGame.test.tsx, Quiz.test.tsx 테스트 파일
</objective>

<execution_context>
@/Users/lyvakim/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lyvakim/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-unit-tests/02-01-SUMMARY.md

# Target components
@components/gacha_simulator/GachaGame.tsx
@components/quiz/Quiz.tsx

# Test infrastructure
@jest.config.js
@jest.setup.js
@__tests__/fixtures/index.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: GachaGame 컴포넌트 테스트</name>
  <files>__tests__/components/GachaGame.test.tsx</files>
  <action>
GachaGame 컴포넌트의 렌더링 및 상호작용 테스트를 작성한다.

테스트 케이스:
1. 기본 렌더링 - 배너 목록, 뽑기 버튼이 렌더링되는지 확인
2. 배너 선택 - 다른 배너 클릭 시 선택된 배너가 변경되는지 확인
3. 배너 타입 전환 - "복각픽업" 토글 클릭 시 배너 목록이 변경되는지 확인
4. 1회 뽑기 버튼 클릭 - 결과가 표시되는지 확인
5. 10회 뽑기 버튼 클릭 - 10개 결과가 표시되는지 확인
6. 통계 표시 - 총 뽑기 횟수, 6성 횟수가 올바르게 표시되는지 확인
7. 리셋 버튼 - 상태가 초기화되는지 확인

모킹 전략:
- next/image: jest.mock으로 img 태그로 대체
- framer-motion: jest.mock으로 일반 div로 대체
- react-hot-toast: jest.mock으로 빈 함수로 대체
- @/data/banners, @/data/characters: 실제 데이터 사용 (fixtures 불필요, 실제 동작 테스트)

한국어 테스트 설명 패턴 유지 (프로젝트 컨벤션)
  </action>
  <verify>
npm run test:unit -- --testPathPattern="GachaGame" --verbose
모든 테스트가 PASS해야 함
  </verify>
  <done>
GachaGame 컴포넌트가 배너 선택, 뽑기 버튼 클릭, 결과 표시, 리셋 동작을 올바르게 처리함이 7개 이상의 테스트로 검증됨
  </done>
</task>

<task type="auto">
  <name>Task 2: Quiz 컴포넌트 테스트</name>
  <files>__tests__/components/Quiz.test.tsx</files>
  <action>
Quiz 컴포넌트의 전체 플로우 테스트를 작성한다.

테스트 케이스:
1. 기본 렌더링 - setup 페이즈에서 퀴즈 세트 선택 화면이 표시되는지 확인
2. 퀴즈 세트 선택 - 퀴즈 세트 클릭 시 해당 세트가 선택되는지 확인
3. 퀴즈 시작 - "퀴즈 시작" 버튼 클릭 후 warning -> playing 전환 확인
4. 문제 표시 - playing 페이즈에서 문제와 선택지가 표시되는지 확인
5. 답변 선택 - 선택지 클릭 시 답변이 기록되고 다음 문제로 이동하는지 확인
6. 타이머 동작 - 문제별 타이머가 표시되고 카운트다운되는지 확인 (fake timers 사용)
7. 퀴즈 완료 - 모든 문제 완료 후 결과 화면이 표시되는지 확인
8. 결과 표시 - 결과 화면에서 점수, 정답률이 표시되는지 확인

모킹 전략:
- framer-motion: jest.mock으로 일반 div로 대체
- next/image: jest.mock으로 img 태그로 대체
- react-hot-toast: jest.mock으로 빈 함수로 대체
- localStorage: jest.spyOn으로 모킹 (quiz attempts tracking)
- @/lib/posthog: jest.mock으로 analytics 모킹
- 타이머: jest.useFakeTimers() 사용

initialQuizSetId prop을 활용하여 setup 단계를 스킵하는 테스트도 포함

한국어 테스트 설명 패턴 유지 (프로젝트 컨벤션)
  </action>
  <verify>
npm run test:unit -- --testPathPattern="Quiz" --verbose
모든 테스트가 PASS해야 함
  </verify>
  <done>
Quiz 컴포넌트가 퀴즈 세트 선택, 문제 표시, 답변 처리, 타이머 동작, 결과 표시를 올바르게 처리함이 8개 이상의 테스트로 검증됨
  </done>
</task>

</tasks>

<verification>
npm run test:unit -- --testPathPattern="components" --verbose
모든 컴포넌트 테스트가 PASS해야 함
</verification>

<success_criteria>
1. GachaGame.test.tsx에서 7개 이상의 테스트가 통과
2. Quiz.test.tsx에서 8개 이상의 테스트가 통과
3. 각 테스트가 사용자 관점의 상호작용(클릭, 선택, 결과 확인)을 검증
4. npm run test:unit 실행 시 모든 테스트 통과
</success_criteria>

<output>
After completion, create `.planning/phases/03-component-tests/03-01-SUMMARY.md`
</output>
