---
phase: 04-e2e-tests
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - __tests__/e2e/gacha.spec.ts
  - __tests__/e2e/quiz.spec.ts
autonomous: true

must_haves:
  truths:
    - "사용자가 가챠 시뮬레이터에서 배너를 선택하고 뽑기를 할 수 있다"
    - "가챠 뽑기 후 결과가 화면에 표시된다"
    - "사용자가 퀴즈를 선택하고 답변을 제출할 수 있다"
    - "퀴즈 완료 후 결과 화면이 표시된다"
  artifacts:
    - path: "__tests__/e2e/gacha.spec.ts"
      provides: "가챠 시뮬레이션 E2E 플로우 테스트"
      min_lines: 60
    - path: "__tests__/e2e/quiz.spec.ts"
      provides: "퀴즈 완료 E2E 플로우 테스트"
      min_lines: 60
  key_links:
    - from: "__tests__/e2e/gacha.spec.ts"
      to: "/gacha_simulator"
      via: "page.goto and user interactions"
      pattern: "page\\.goto.*gacha_simulator"
    - from: "__tests__/e2e/quiz.spec.ts"
      to: "/quiz"
      via: "page.goto and user interactions"
      pattern: "page\\.goto.*quiz"
---

<objective>
가챠 시뮬레이션과 퀴즈 플로우의 E2E 테스트를 작성한다.

Purpose: 핵심 게임플레이 기능(가챠, 퀴즈)이 실제 브라우저에서 end-to-end로 동작함을 검증
Output: gacha.spec.ts, quiz.spec.ts E2E 테스트 파일
</objective>

<execution_context>
@/Users/lyvakim/.claude/get-shit-done/workflows/execute-plan.md
@/Users/lyvakim/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-infrastructure/01-01-SUMMARY.md

# E2E infrastructure
@playwright.config.ts
@__tests__/e2e/smoke.spec.ts

# Target pages
@app/gacha_simulator/page.tsx
@app/quiz/page.tsx
@app/quiz/[quizSetId]/page.tsx

# Key components for understanding flow
@components/gacha_simulator/GachaGame.tsx
@components/quiz/Quiz.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: 가챠 시뮬레이션 E2E 테스트</name>
  <files>__tests__/e2e/gacha.spec.ts</files>
  <action>
가챠 시뮬레이션의 전체 사용자 플로우를 E2E 테스트로 작성한다.

테스트 케이스:
1. 페이지 로드 - 가챠 시뮬레이터 페이지가 정상 로드되고 배너가 표시되는지 확인
2. 배너 선택 - 배너 목록에서 다른 배너 클릭 시 선택이 변경되는지 확인
3. 1회 뽑기 - "1뽑" 버튼 클릭 후 결과 캐릭터가 표시되는지 확인
4. 10회 뽑기 - "10뽑" 버튼 클릭 후 10개 결과가 표시되는지 확인
5. 통계 업데이트 - 뽑기 후 총 뽑기 횟수가 업데이트되는지 확인
6. 복각픽업 전환 - "복각픽업" 토글 클릭 시 배너 목록이 변경되는지 확인
7. 리셋 - "리셋" 버튼 클릭 시 통계가 초기화되는지 확인

Playwright 패턴:
- page.goto('/gacha_simulator')로 페이지 이동
- page.locator()로 요소 선택 (role, text 기반)
- expect(locator).toBeVisible() 가시성 확인
- locator.click()으로 사용자 인터랙션
- expect(locator).toContainText()로 내용 확인

주의사항:
- 가챠 결과는 랜덤이므로 결과 '존재'만 확인 (특정 캐릭터 확인 X)
- 네트워크 요청 없음 (클라이언트 사이드 로직)
- 이미지 로딩 대기 위해 waitForLoadState 활용
  </action>
  <verify>
npx playwright test gacha.spec.ts --reporter=list
모든 테스트가 PASS해야 함
  </verify>
  <done>
가챠 시뮬레이션 플로우(페이지 로드 -> 배너 선택 -> 뽑기 -> 결과 확인 -> 리셋)가 7개 이상의 E2E 테스트로 검증됨
  </done>
</task>

<task type="auto">
  <name>Task 2: 퀴즈 완료 E2E 테스트</name>
  <files>__tests__/e2e/quiz.spec.ts</files>
  <action>
퀴즈 완료 전체 플로우를 E2E 테스트로 작성한다.

테스트 케이스:
1. 퀴즈 선택 페이지 로드 - /quiz 페이지에서 퀴즈 세트 목록이 표시되는지 확인
2. 퀴즈 세트 선택 - 잠금 해제된 퀴즈 세트 클릭 시 퀴즈 페이지로 이동하는지 확인
3. 퀴즈 시작 - 경고 화면에서 "시작" 버튼 클릭 후 퀴즈가 시작되는지 확인
4. 문제 표시 - 문제 텍스트와 선택지가 표시되는지 확인
5. 답변 선택 - 선택지 클릭 후 다음 문제로 이동하는지 확인
6. 퀴즈 완료 - 모든 문제 답변 후 결과 화면이 표시되는지 확인
7. 결과 표시 - 점수와 정답률이 결과 화면에 표시되는지 확인
8. 재도전 - "다시 도전" 버튼 클릭 시 퀴즈가 재시작되는지 확인

Playwright 패턴:
- page.goto('/quiz')로 퀴즈 선택 페이지 이동
- 첫 번째 활성화된 퀴즈 세트(멜라니아의 금고 털기) 선택
- page.waitForURL()로 페이지 이동 확인
- 타이머가 있으므로 빠르게 답변 선택 (정답/오답 무관, 플로우만 확인)

주의사항:
- 퀴즈는 20문제이나 테스트에서는 maxAttempts(3번 틀리면 종료)를 활용하여 빠르게 완료
- 또는 처음 몇 문제만 답하고 나머지는 타임아웃으로 진행
- localStorage 사용 (랭킹 저장) - Playwright는 새 컨텍스트마다 초기화됨
  </action>
  <verify>
npx playwright test quiz.spec.ts --reporter=list
모든 테스트가 PASS해야 함
  </verify>
  <done>
퀴즈 플로우(퀴즈 선택 -> 시작 -> 답변 -> 결과 확인 -> 재도전)가 8개 이상의 E2E 테스트로 검증됨
  </done>
</task>

</tasks>

<verification>
npx playwright test gacha.spec.ts quiz.spec.ts --reporter=list
모든 E2E 테스트가 PASS해야 함
</verification>

<success_criteria>
1. gacha.spec.ts에서 7개 이상의 테스트가 통과
2. quiz.spec.ts에서 8개 이상의 테스트가 통과
3. 각 테스트가 실제 브라우저에서 사용자 플로우를 검증
4. npm run test:e2e 실행 시 모든 E2E 테스트 통과
</success_criteria>

<output>
After completion, create `.planning/phases/04-e2e-tests/04-01-SUMMARY.md`
</output>
